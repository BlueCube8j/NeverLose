-- NEVERLOSE HUB PRO EDITION (FULL CODE)
-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Stats = game:GetService("Stats")
local SoundService = game:GetService("SoundService")

-- Configuration
local Config = {
    ESP = {
        Enabled = true,
        HealthBar = true,
        MaxDistance = 300,
        Color = Color3.new(1, 1, 1)
    },
    AimLock = {
        Enabled = true,
        Key = "Q",
        FOV = 60,
        Smoothness = 0.5,
        Prediction = 0.15,
        TeamCheck = false
    },
    TriggerBot = {
        Enabled = false,
        Delay = 0.1
    },
    SpinBot = {
        Enabled = false,
        Speed = 35
    },
    Misc = {
        Tracers = false,
        JumpMarks = false,
        HitSounds = false,
        BackgroundSound = false,
        SoundId = ""
    }
}

-- State
local AimActive = false
local CurrentTarget = nil
local ESPDrawings = {}
local TracerDrawings = {}
local VelocityCache = {}
local MainFramePosition = UDim2.new(0, 20, 0.5, -175)
local UIVisible = true
local Authenticated = false

-- Sound IDs
local HitSounds = {
    Hit = 96373156404300,
    Kill = 105714474522917
}

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NeverLosePro"
ScreenGui.Parent = game:GetService("CoreGui")

-- Minimized window
local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Size = UDim2.new(0, 220, 0, 50)
MinimizedFrame.Position = UDim2.new(0, 10, 0, 10)
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
MinimizedFrame.BackgroundTransparency = 0.05
MinimizedFrame.Visible = false
MinimizedFrame.Parent = ScreenGui

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(0, 8)
MinimizedCorner.Parent = MinimizedFrame

local MinimizedText = Instance.new("TextLabel")
MinimizedText.Size = UDim2.new(1, -10, 0.7, 0)
MinimizedText.Position = UDim2.new(0, 5, 0, 5)
MinimizedText.BackgroundTransparency = 1
MinimizedText.Text = "NeverLose | ...ping | ...FPS | Pro Edition"
MinimizedText.TextColor3 = Color3.new(1, 1, 1)
MinimizedText.Font = Enum.Font.GothamMedium
MinimizedText.TextSize = 12
MinimizedText.TextXAlignment = Enum.TextXAlignment.Left
MinimizedText.Parent = MinimizedFrame

local PurpleBar = Instance.new("Frame")
PurpleBar.Size = UDim2.new(1, -20, 0, 2)
PurpleBar.Position = UDim2.new(0, 10, 1, -4)
PurpleBar.BackgroundColor3 = Color3.fromRGB(170, 0, 255)
PurpleBar.BorderSizePixel = 0
PurpleBar.Parent = MinimizedFrame

-- FPS/PING Update
local function UpdateStatsDisplay()
    local fps = math.floor(1 / RunService.RenderStepped:Wait())
    local ping = "?"
    
    local network = Stats.Network
    if network then
        ping = math.floor((network.ServerStatsItem["Data Ping"] or 0) * 1000)
    end
    
    MinimizedText.Text = string.format("NeverLose | %dms | %d FPS | Pro Edition", ping, fps)
end

-- ==================== ESP SYSTEM ====================
local function UpdateESP()
    if not Config.ESP.Enabled then
        for _, drawings in pairs(ESPDrawings) do
            drawings.Box.Visible = false
            drawings.HealthBar.Visible = false
            drawings.Name.Visible = false
        end
        return
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        
        local character = player.Character
        if not character then
            if ESPDrawings[player] then
                ESPDrawings[player].Box.Visible = false
                ESPDrawings[player].HealthBar.Visible = false
                ESPDrawings[player].Name.Visible = false
            end
            continue
        end
        
        local humanoid = character:FindFirstChild("Humanoid")
        local head = character:FindFirstChild("Head")
        if not humanoid or not head or humanoid.Health <= 0 then
            if ESPDrawings[player] then
                ESPDrawings[player].Box.Visible = false
                ESPDrawings[player].HealthBar.Visible = false
                ESPDrawings[player].Name.Visible = false
            end
            continue
        end
        
        local distance = (head.Position - Camera.CFrame.Position).Magnitude
        if distance > Config.ESP.MaxDistance then
            if ESPDrawings[player] then
                ESPDrawings[player].Box.Visible = false
                ESPDrawings[player].HealthBar.Visible = false
                ESPDrawings[player].Name.Visible = false
            end
            continue
        end
        
        -- Create drawings if not exists
        if not ESPDrawings[player] then
            ESPDrawings[player] = {
                Box = Drawing.new("Square"),
                HealthBar = Drawing.new("Square"),
                Name = Drawing.new("Text")
            }
            ESPDrawings[player].Box.Color = Config.ESP.Color
            ESPDrawings[player].Box.Thickness = 1
            ESPDrawings[player].Box.Filled = false
            
            ESPDrawings[player].Name.Color = Config.ESP.Color
            ESPDrawings[player].Name.Size = 13
            ESPDrawings[player].Name.Outline = true
        end
        
        local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
        if onScreen then
            -- Box size
            local scale = 1000 / math.max(distance, 10)
            local boxSize = math.clamp(15 * scale / 100, 25, 60)
            
            -- Box position
            local boxX = pos.X
            local boxY = pos.Y - boxSize * 0.75
            
            ESPDrawings[player].Box.Size = Vector2.new(boxSize, boxSize * 1.5)
            ESPDrawings[player].Box.Position = Vector2.new(boxX - boxSize/2, boxY)
            ESPDrawings[player].Box.Visible = true
            
            -- Health bar (vertical, left side)
            if Config.ESP.HealthBar then
                local healthPercent = humanoid.Health / humanoid.MaxHealth
                local barHeight = boxSize * 1.5
                local healthHeight = barHeight * healthPercent
                
                ESPDrawings[player].HealthBar.Size = Vector2.new(3, barHeight)
                ESPDrawings[player].HealthBar.Position = Vector2.new(boxX - boxSize/2 - 6, boxY)
                ESPDrawings[player].HealthBar.Filled = true
                ESPDrawings[player].HealthBar.Visible = true
                
                -- Color based on health
                if healthPercent > 0.5 then
                    ESPDrawings[player].HealthBar.Color = Color3.new(0, 1, 0) -- Green
                elseif healthPercent > 0.25 then
                    ESPDrawings[player].HealthBar.Color = Color3.new(1, 1, 0) -- Yellow
                else
                    ESPDrawings[player].HealthBar.Color = Color3.new(1, 0, 0) -- Red
                end
            else
                ESPDrawings[player].HealthBar.Visible = false
            end
            
            -- Name
            ESPDrawings[player].Name.Position = Vector2.new(boxX, boxY - 15)
            ESPDrawings[player].Name.Text = player.Name .. " [" .. math.floor(distance) .. "]"
            ESPDrawings[player].Name.Visible = true
            
            -- Cache velocity for prediction
            local root = character:FindFirstChild("HumanoidRootPart")
            if root then
                VelocityCache[player] = root.Velocity
            end
        else
            ESPDrawings[player].Box.Visible = false
            ESPDrawings[player].HealthBar.Visible = false
            ESPDrawings[player].Name.Visible = false
        end
    end
end

-- ==================== AIM LOCK WITH PREDICTION ====================
local function GetClosestTarget()
    local closest = nil
    local closestDist = Config.AimLock.FOV
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        if Config.AimLock.TeamCheck and player.Team == LocalPlayer.Team then continue end
        
        local character = player.Character
        if not character then continue end
        
        local humanoid = character:FindFirstChild("Humanoid")
        local head = character:FindFirstChild("Head")
        if not humanoid or not head or humanoid.Health <= 0 then continue end
        
        local distance = (head.Position - Camera.CFrame.Position).Magnitude
        if distance > 300 then continue end
        
        local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
        if not onScreen then continue end
        
        local screenDist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
        if screenDist < closestDist then
            closest = player
            closestDist = screenDist
        end
    end
    
    return closest
end

local function AimAtTarget(target)
    if not target or not target.Character then return end
    
    local head = target.Character:FindFirstChild("Head")
    if not head then return end
    
    -- Apply prediction
    local predictedPosition = head.Position
    if Config.AimLock.Prediction > 0 and VelocityCache[target] then
        predictedPosition = head.Position + (VelocityCache[target] * Config.AimLock.Prediction)
    end
    
    local cameraPos = Camera.CFrame.Position
    local targetCFrame = CFrame.new(cameraPos, predictedPosition)
    Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, Config.AimLock.Smoothness)
end

-- ==================== TRACERS (PURPLE BULLET TRAILS) ====================
local function CreateTracer(startPos, endPos)
    local tracer = Drawing.new("Line")
    tracer.From = startPos
    tracer.To = endPos
    tracer.Color = Color3.fromRGB(170, 0, 255) -- Purple
    tracer.Thickness = 2
    tracer.Transparency = 1
    
    -- Fade out animation
    spawn(function()
        for i = 1, 20 do
            tracer.Transparency = i/20
            task.wait(0.03)
        end
        tracer:Remove()
    end)
    
    table.insert(TracerDrawings, tracer)
end

-- ==================== HIT SOUNDS ====================
local function SetupHitSounds()
    local hitSound = Instance.new("Sound")
    hitSound.SoundId = "rbxassetid://" .. HitSounds.Hit
    hitSound.Volume = 0.6
    hitSound.Parent = SoundService
    
    local killSound = Instance.new("Sound")
    killSound.SoundId = "rbxassetid://" .. HitSounds.Kill
    killSound.Volume = 0.7
    killSound.Parent = SoundService
    
    local playerHealth = {}
    
    local function TrackPlayer(player)
        if player == LocalPlayer then return end
        
        spawn(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character:WaitForChild("Humanoid", 5)
            if not humanoid then return end
            
            playerHealth[player] = humanoid.Health
            
            humanoid.HealthChanged:Connect(function(newHealth)
                if not Config.Misc.HitSounds then return end
                
                local oldHealth = playerHealth[player] or newHealth
                
                if newHealth < oldHealth then
                    hitSound:Play()
                    
                    if newHealth <= 0 then
                        task.wait(0.2)
                        killSound:Play()
                    end
                end
                
                playerHealth[player] = newHealth
            end)
        end)
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        TrackPlayer(player)
    end
    
    Players.PlayerAdded:Connect(TrackPlayer)
end

-- ==================== INPUT HANDLING ====================
UIS.InputBegan:Connect(function(input)
    -- Toggle UI with L
    if input.KeyCode == Enum.KeyCode.L then
        UIVisible = not UIVisible
        
        if MainFrame then
            MainFrame.Visible = UIVisible
        end
        MinimizedFrame.Visible = not UIVisible
    end
    
    -- Aim Lock toggle with configurable key
    if input.KeyCode.Name == Config.AimLock.Key and Config.AimLock.Enabled then
        AimActive = not AimActive
        if AimActive then
            CurrentTarget = GetClosestTarget()
        else
            CurrentTarget = nil
        end
    end
end)

-- ==================== MAIN LOOP ====================
RunService.RenderStepped:Connect(function()
    UpdateStatsDisplay()
    
    if Authenticated then
        UpdateESP()
        
        -- Aim Lock
        if AimActive and Config.AimLock.Enabled then
            if CurrentTarget and CurrentTarget.Character then
                AimAtTarget(CurrentTarget)
            else
                CurrentTarget = GetClosestTarget()
            end
        end
        
        -- SpinBot
        if Config.SpinBot.Enabled and LocalPlayer.Character then
            local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if root then
                SpinBotAngle = (SpinBotAngle + Config.SpinBot.Speed) % 360
                root.CFrame = root.CFrame * CFrame.Angles(0, math.rad(SpinBotAngle), 0)
            end
        end
    end
end)

-- Cleanup
Players.PlayerRemoving:Connect(function(player)
    if ESPDrawings[player] then
        ESPDrawings[player].Box:Remove()
        ESPDrawings[player].HealthBar:Remove()
        ESPDrawings[player].Name:Remove()
        ESPDrawings[player] = nil
    end
    VelocityCache[player] = nil
end)

-- Initialize
SetupHitSounds()
print("NeverLose Pro Edition loaded for Criminality")

-- Note: Здесь должна быть твоя система загрузки и аутентификации
-- После успешного ввода ключа установи Authenticated = true
