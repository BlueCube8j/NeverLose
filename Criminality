--[[
    NEVERLOSE PRO EDITION - ULTIMATE UNABRIDGED
    BUILD: 4.0 (FINAL)
    FEATURES:
    - Full Intro Animation (TweenService)
    - Key Authentication System
    - Minimized Stats Widget
    - Full Functionality (Aim, ESP, Trigger, Spin)
    - Mouse & Keyboard Support
]]

-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Stats = game:GetService("Stats")
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")

-- Safety Check
local function is_exploit_supported()
    if not Drawing then return false, "Drawing API missing" end
    if not mouse1press then return false, "Mouse input missing" end
    return true, "OK"
end

-- Configuration (Global)
getgenv().NL_Config = {
    Key = "WELCOME2024", -- Access Key
    ESP = {
        Enabled = true,
        Boxes = true,
        Names = true,
        Health = true,
        MaxDist = 300,
        Color = Color3.fromRGB(255, 255, 255)
    },
    Aim = {
        Enabled = true,
        Key = Enum.KeyCode.Q,
        FOV = 30,
        Smooth = 0.2,
        Part = "Head",
        TeamCheck = false,
        Predict = 0.135
    },
    Trigger = {
        Enabled = false,
        Delay = 0.05,
        Dist = 150
    },
    Misc = {
        SpinBot = false,
        SpinSpeed = 20,
        FOV_Circle = true
    }
}

-- Variables
local Aiming = false
local CurrentTarget = nil
local ESP_Table = {}
local UI_Visible = true
local Authenticated = false
local TracerTable = {}

-- GUI CREATION (VERBOSE MODE)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NeverLose_Ultimate"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
if getgenv().protect_gui then getgenv().protect_gui(ScreenGui) end
ScreenGui.Parent = CoreGui

-- 1. INTRO / LOADER SCREEN
local LoaderFrame = Instance.new("Frame")
LoaderFrame.Name = "Loader"
LoaderFrame.Parent = ScreenGui
LoaderFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
LoaderFrame.BorderSizePixel = 0
LoaderFrame.Position = UDim2.new(0.5, -200, 0.5, -100)
LoaderFrame.Size = UDim2.new(0, 400, 0, 200)
LoaderFrame.ZIndex = 100
LoaderFrame.Visible = true

local LoaderCorner = Instance.new("UICorner")
LoaderCorner.CornerRadius = UDim.new(0, 10)
LoaderCorner.Parent = LoaderFrame

local LetterN = Instance.new("TextLabel")
LetterN.Name = "N"
LetterN.Parent = LoaderFrame
LetterN.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
LetterN.BackgroundTransparency = 1.000
LetterN.Position = UDim2.new(0.3, 0, 0.2, 0)
LetterN.Size = UDim2.new(0, 60, 0, 80)
LetterN.Font = Enum.Font.GothamBlack
LetterN.Text = "N"
LetterN.TextColor3 = Color3.fromRGB(255, 255, 255)
LetterN.TextSize = 72.000
LetterN.TextTransparency = 1

local LetterL = Instance.new("TextLabel")
LetterL.Name = "L"
LetterL.Parent = LoaderFrame
LetterL.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
LetterL.BackgroundTransparency = 1.000
LetterL.Position = UDim2.new(0.55, 0, 0.2, 0)
LetterL.Size = UDim2.new(0, 60, 0, 80)
LetterL.Font = Enum.Font.GothamBlack
LetterL.Text = "L"
LetterL.TextColor3 = Color3.fromRGB(0, 170, 255) -- NL Blue
LetterL.TextSize = 72.000
LetterL.TextTransparency = 1

local LoadingBarBack = Instance.new("Frame")
LoadingBarBack.Name = "BarBack"
LoadingBarBack.Parent = LoaderFrame
LoadingBarBack.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
LoadingBarBack.BorderSizePixel = 0
LoadingBarBack.Position = UDim2.new(0.1, 0, 0.8, 0)
LoadingBarBack.Size = UDim2.new(0.8, 0, 0, 6)

local LoadingBarFill = Instance.new("Frame")
LoadingBarFill.Name = "BarFill"
LoadingBarFill.Parent = LoadingBarBack
LoadingBarFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
LoadingBarFill.BorderSizePixel = 0
LoadingBarFill.Size = UDim2.new(0, 0, 1, 0)

local StatusText = Instance.new("TextLabel")
StatusText.Parent = LoaderFrame
StatusText.BackgroundTransparency = 1
StatusText.Position = UDim2.new(0, 0, 0.85, 0)
StatusText.Size = UDim2.new(1, 0, 0, 20)
StatusText.Font = Enum.Font.GothamBold
StatusText.Text = "Initializing..."
StatusText.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusText.TextSize = 12

-- 2. KEY SYSTEM SCREEN
local KeyFrame = Instance.new("Frame")
KeyFrame.Name = "KeySystem"
KeyFrame.Parent = ScreenGui
KeyFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
KeyFrame.Position = UDim2.new(0.5, -150, 0.5, -80)
KeyFrame.Size = UDim2.new(0, 300, 0, 160)
KeyFrame.Visible = false -- Hidden initially
KeyFrame.BorderSizePixel = 0
KeyFrame.ZIndex = 90

local KeyCorner = Instance.new("UICorner")
KeyCorner.CornerRadius = UDim.new(0, 8)
KeyCorner.Parent = KeyFrame

local KeyTitle = Instance.new("TextLabel")
KeyTitle.Parent = KeyFrame
KeyTitle.BackgroundTransparency = 1
KeyTitle.Position = UDim2.new(0, 0, 0.1, 0)
KeyTitle.Size = UDim2.new(1, 0, 0, 30)
KeyTitle.Font = Enum.Font.GothamBold
KeyTitle.Text = "AUTHENTICATION"
KeyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyTitle.TextSize = 18

local KeyInput = Instance.new("TextBox")
KeyInput.Parent = KeyFrame
KeyInput.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
KeyInput.Position = UDim2.new(0.1, 0, 0.4, 0)
KeyInput.Size = UDim2.new(0.8, 0, 0, 35)
KeyInput.Font = Enum.Font.Gotham
KeyInput.PlaceholderText = "Enter Key Here..."
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(200, 200, 200)
KeyInput.TextSize = 14
Instance.new("UICorner", KeyInput).CornerRadius = UDim.new(0, 6)

local EnterBtn = Instance.new("TextButton")
EnterBtn.Parent = KeyFrame
EnterBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 200)
EnterBtn.Position = UDim2.new(0.25, 0, 0.7, 0)
EnterBtn.Size = UDim2.new(0.5, 0, 0, 30)
EnterBtn.Font = Enum.Font.GothamBold
EnterBtn.Text = "LOGIN"
EnterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
EnterBtn.TextSize = 14
Instance.new("UICorner", EnterBtn).CornerRadius = UDim.new(0, 6)

-- 3. MINIMIZED WIDGET
local Widget = Instance.new("Frame")
Widget.Name = "StatsWidget"
Widget.Parent = ScreenGui
Widget.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Widget.BackgroundTransparency = 0.2
Widget.Position = UDim2.new(0, 20, 0, 20)
Widget.Size = UDim2.new(0, 220, 0, 40)
Widget.Visible = false
Instance.new("UICorner", Widget).CornerRadius = UDim.new(0, 6)

local WidgetText = Instance.new("TextLabel")
WidgetText.Parent = Widget
WidgetText.BackgroundTransparency = 1
WidgetText.Position = UDim2.new(0, 10, 0, 0)
WidgetText.Size = UDim2.new(1, -20, 1, 0)
WidgetText.Font = Enum.Font.GothamSemibold
WidgetText.Text = "NL | FPS: 0 | Ping: 0ms"
WidgetText.TextColor3 = Color3.fromRGB(255, 255, 255)
WidgetText.TextSize = 14
WidgetText.TextXAlignment = Enum.TextXAlignment.Left

local WidgetBar = Instance.new("Frame")
WidgetBar.Parent = Widget
WidgetBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
WidgetBar.BorderSizePixel = 0
WidgetBar.Position = UDim2.new(0, 0, 1, -2)
WidgetBar.Size = UDim2.new(1, 0, 0, 2)

-- 4. MAIN INTERFACE
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainUI"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(12, 12, 15)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
MainFrame.Size = UDim2.new(0, 500, 0, 350)
MainFrame.Visible = false
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)

-- Side Bar
local SideBar = Instance.new("Frame")
SideBar.Parent = MainFrame
SideBar.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
SideBar.Size = UDim2.new(0, 120, 1, 0)
Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0, 8)

-- Logo
local Logo = Instance.new("TextLabel")
Logo.Parent = SideBar
Logo.BackgroundTransparency = 1
Logo.Position = UDim2.new(0, 0, 0, 10)
Logo.Size = UDim2.new(1, 0, 0, 40)
Logo.Font = Enum.Font.GothamBlack
Logo.Text = "NEVERLOSE"
Logo.TextColor3 = Color3.fromRGB(255, 255, 255)
Logo.TextSize = 18

-- Tab Buttons Container
local TabContainer = Instance.new("Frame")
TabContainer.Parent = SideBar
TabContainer.BackgroundTransparency = 1
TabContainer.Position = UDim2.new(0, 0, 0, 60)
TabContainer.Size = UDim2.new(1, 0, 1, -60)

local UIList = Instance.new("UIListLayout")
UIList.Parent = TabContainer
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIList.SortOrder = Enum.SortOrder.LayoutOrder
UIList.Padding = UDim.new(0, 10)

-- Content Area
local ContentArea = Instance.new("Frame")
ContentArea.Parent = MainFrame
ContentArea.BackgroundTransparency = 1
ContentArea.Position = UDim2.new(0, 130, 0, 10)
ContentArea.Size = UDim2.new(1, -140, 1, -20)

-- Helper for Creating Tabs
local Tabs = {}
local function MakeTab(text, icon)
    local TabBtn = Instance.new("TextButton")
    TabBtn.Parent = TabContainer
    TabBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    TabBtn.Size = UDim2.new(0.8, 0, 0, 35)
    TabBtn.Font = Enum.Font.GothamBold
    TabBtn.Text = text
    TabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    TabBtn.TextSize = 12
    Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 6)
    
    local TabPage = Instance.new("ScrollingFrame")
    TabPage.Parent = ContentArea
    TabPage.BackgroundTransparency = 1
    TabPage.Size = UDim2.new(1, 0, 1, 0)
    TabPage.Visible = false
    TabPage.ScrollBarThickness = 2
    
    local PageList = Instance.new("UIListLayout")
    PageList.Parent = TabPage
    PageList.Padding = UDim.new(0, 8)
    
    TabBtn.MouseButton1Click:Connect(function()
        for _, t in pairs(Tabs) do 
            t.Page.Visible = false
            t.Btn.TextColor3 = Color3.fromRGB(150, 150, 150)
            t.Btn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
        end
        TabPage.Visible = true
        TabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    end)
    
    table.insert(Tabs, {Btn = TabBtn, Page = TabPage})
    return TabPage
end

-- Helper for Toggles
local function MakeToggle(parent, text, default, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Parent = parent
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    ToggleFrame.Size = UDim2.new(1, -5, 0, 40)
    Instance.new("UICorner", ToggleFrame).CornerRadius = UDim.new(0, 6)
    
    local Label = Instance.new("TextLabel")
    Label.Parent = ToggleFrame
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0, 10, 0, 0)
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.Font = Enum.Font.GothamSemibold
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(220, 220, 220)
    Label.TextSize = 13
    Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local Btn = Instance.new("TextButton")
    Btn.Parent = ToggleFrame
    Btn.BackgroundColor3 = default and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(40, 40, 45)
    Btn.Position = UDim2.new(1, -50, 0.5, -10)
    Btn.Size = UDim2.new(0, 40, 0, 20)
    Btn.Text = ""
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(1, 0)
    
    Btn.MouseButton1Click:Connect(function()
        default = not default
        Btn.BackgroundColor3 = default and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(40, 40, 45)
        callback(default)
    end)
end

-- Helper for Keybinds
local function MakeKeybind(parent, text, defaultKey, callback)
    local Frame = Instance.new("Frame")
    Frame.Parent = parent
    Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    Frame.Size = UDim2.new(1, -5, 0, 40)
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Label = Instance.new("TextLabel")
    Label.Parent = Frame
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0, 10, 0, 0)
    Label.Size = UDim2.new(0.6, 0, 1, 0)
    Label.Font = Enum.Font.GothamSemibold
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(220, 220, 220)
    Label.TextSize = 13
    Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local BindBtn = Instance.new("TextButton")
    BindBtn.Parent = Frame
    BindBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    BindBtn.Position = UDim2.new(1, -80, 0.5, -12)
    BindBtn.Size = UDim2.new(0, 70, 0, 24)
    BindBtn.Font = Enum.Font.GothamBold
    BindBtn.Text = defaultKey.Name
    BindBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    BindBtn.TextSize = 11
    Instance.new("UICorner", BindBtn).CornerRadius = UDim.new(0, 4)
    
    local listening = false
    BindBtn.MouseButton1Click:Connect(function()
        if listening then return end
        listening = true
        BindBtn.Text = "..."
        BindBtn.TextColor3 = Color3.fromRGB(0, 170, 255)
        
        local con
        con = UserInputService.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Keyboard then
                BindBtn.Text = input.KeyCode.Name
                BindBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
                callback(input.KeyCode)
                listening = false
                con:Disconnect()
            elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
                BindBtn.Text = "RMB"
                BindBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
                callback(Enum.UserInputType.MouseButton2)
                listening = false
                con:Disconnect()
            end
        end)
    end)
end

-- Helper for Slider
local function MakeSlider(parent, text, min, max, default, callback)
    local SliderFrame = Instance.new("Frame")
    SliderFrame.Parent = parent
    SliderFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    SliderFrame.Size = UDim2.new(1, -5, 0, 50)
    Instance.new("UICorner", SliderFrame).CornerRadius = UDim.new(0, 6)
    
    local Label = Instance.new("TextLabel")
    Label.Parent = SliderFrame
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0, 10, 0, 5)
    Label.Size = UDim2.new(0.7, 0, 0, 20)
    Label.Font = Enum.Font.GothamSemibold
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(220, 220, 220)
    Label.TextSize = 13
    Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local ValueText = Instance.new("TextLabel")
    ValueText.Parent = SliderFrame
    ValueText.BackgroundTransparency = 1
    ValueText.Position = UDim2.new(0.7, 0, 0, 5)
    ValueText.Size = UDim2.new(0.3, -10, 0, 20)
    ValueText.Font = Enum.Font.GothamBold
    ValueText.Text = tostring(default)
    ValueText.TextColor3 = Color3.fromRGB(0, 170, 255)
    ValueText.TextSize = 13
    ValueText.TextXAlignment = Enum.TextXAlignment.Right
    
    local Track = Instance.new("Frame")
    Track.Parent = SliderFrame
    Track.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    Track.Position = UDim2.new(0.05, 0, 0.7, 0)
    Track.Size = UDim2.new(0.9, 0, 0, 4)
    Instance.new("UICorner", Track).CornerRadius = UDim.new(0, 2)
    
    local Fill = Instance.new("Frame")
    Fill.Parent = Track
    Fill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    Fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    Instance.new("UICorner", Fill).CornerRadius = UDim.new(0, 2)
    
    local SliderBtn = Instance.new("TextButton")
    SliderBtn.Parent = Track
    SliderBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    SliderBtn.Size = UDim2.new(0, 10, 2, 0)
    SliderBtn.Position = UDim2.new((default - min) / (max - min), -5, -0.5, 0)
    SliderBtn.Text = ""
    Instance.new("UICorner", SliderBtn).CornerRadius = UDim.new(1, 0)
    
    local dragging = false
    local function update(value)
        local percent = math.clamp((value - min) / (max - min), 0, 1)
        Fill.Size = UDim2.new(percent, 0, 1, 0)
        SliderBtn.Position = UDim2.new(percent, -5, -0.5, 0)
        local actualValue = math.floor(min + (max - min) * percent)
        ValueText.Text = tostring(actualValue)
        callback(actualValue)
    end
    
    SliderBtn.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    Track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local percent = (input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X
            update(min + (max - min) * math.clamp(percent, 0, 1))
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local percent = (input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X
            update(min + (max - min) * math.clamp(percent, 0, 1))
        end
    end)
    
    update(default)
end

-- POPULATE GUI
local MainTab = MakeTab("Main")
local VisualsTab = MakeTab("Visuals")
local MiscTab = MakeTab("Misc")
local SettingsTab = MakeTab("Settings")

-- Main Tab
MakeToggle(MainTab, "Enable AimLock", false, function(v) getgenv().NL_Config.Aim.Enabled = v end)
MakeKeybind(MainTab, "Aim Key", Enum.KeyCode.Q, function(k) getgenv().NL_Config.Aim.Key = k end)
MakeSlider(MainTab, "Aim FOV", 10, 100, 30, function(v) getgenv().NL_Config.Aim.FOV = v end)
MakeToggle(MainTab, "TriggerBot", false, function(v) getgenv().NL_Config.Trigger.Enabled = v end)

-- Visuals Tab
MakeToggle(VisualsTab, "Enable ESP", true, function(v) getgenv().NL_Config.ESP.Enabled = v end)
MakeToggle(VisualsTab, "Show Boxes", true, function(v) getgenv().NL_Config.ESP.Boxes = v end)
MakeToggle(VisualsTab, "Show Names", true, function(v) getgenv().NL_Config.ESP.Names = v end)
MakeToggle(VisualsTab, "Health Bars", true, function(v) getgenv().NL_Config.ESP.Health = v end)

-- Misc Tab
MakeToggle(MiscTab, "SpinBot", false, function(v) getgenv().NL_Config.Misc.SpinBot = v end)
MakeSlider(MiscTab, "Spin Speed", 5, 50, 20, function(v) getgenv().NL_Config.Misc.SpinSpeed = v end)

-- Settings Tab
MakeKeybind(SettingsTab, "Open/Close Menu", Enum.KeyCode.Insert, function(k)
    getgenv().MenuKey = k
end)

-- LOGIC IMPLEMENTATION

-- 1. Toggle AimLock System
local ToggleAim = false
local LastTarget = nil

local function GetTarget()
    local closest, maxScore = nil, math.huge
    local mousePos = UserInputService:GetMouseLocation()
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Humanoid") and plr.Character.Humanoid.Health > 0 then
            local part = plr.Character:FindFirstChild(getgenv().NL_Config.Aim.Part)
            if part then
                local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                    if dist < getgenv().NL_Config.Aim.FOV and dist < maxScore then
                        maxScore = dist
                        closest = plr
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if not Authenticated then return end
    
    -- Toggle AimLock
    if getgenv().NL_Config.Aim.Enabled and ToggleAim then
        if not LastTarget or not LastTarget.Character or LastTarget.Character.Humanoid.Health <= 0 then
            LastTarget = GetTarget()
        end
        
        if LastTarget and LastTarget.Character then
            local part = LastTarget.Character[getgenv().NL_Config.Aim.Part]
            if part then
                local pos = part.Position + (part.Velocity * getgenv().NL_Config.Aim.Predict)
                local currentCF = Camera.CFrame
                local targetCF = CFrame.new(currentCF.Position, pos)
                Camera.CFrame = currentCF:Lerp(targetCF, getgenv().NL_Config.Aim.Smooth)
            end
        end
    end
    
    -- SpinBot
    if getgenv().NL_Config.Misc.SpinBot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local root = LocalPlayer.Character.HumanoidRootPart
        root.CFrame = root.CFrame * CFrame.Angles(0, math.rad(getgenv().NL_Config.Misc.SpinSpeed), 0)
    end
    
    -- Update Stats
    local fps = math.floor(1 / math.max(RunService.RenderStepped:Wait(), 0.001))
    local ping = math.floor((Stats.Network.ServerStatsItem["Data Ping"] or 0) * 1000)
    WidgetText.Text = string.format("NL Pre Alpha v0.1 | FPS: %d | Ping: %dms", fps, ping)
end)

-- 2. TriggerBot
task.spawn(function()
    while task.wait(getgenv().NL_Config.Trigger.Delay) do
        if Authenticated and getgenv().NL_Config.Trigger.Enabled then
            local mouse = LocalPlayer:GetMouse()
            if mouse.Target and mouse.Target.Parent then
                local plr = Players:GetPlayerFromCharacter(mouse.Target.Parent)
                if plr and plr ~= LocalPlayer then
                    mouse1press()
                    task.wait(0.1)
                    mouse1release()
                end
            end
        end
    end
end)

-- 3. ESP (Drawing API) with player-sized boxes
local function CreateDrawing(type, props)
    local d = Drawing.new(type)
    for k, v in pairs(props) do d[k] = v end
    return d
end

RunService.RenderStepped:Connect(function()
    if not Authenticated or not getgenv().NL_Config.ESP.Enabled then
        for _, v in pairs(ESP_Table) do 
            v.Box.Visible = false
            v.Name.Visible = false
            v.Health.Visible = false
            if v.Tracer then v.Tracer.Visible = false end
        end
        return 
    end

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr.Character.Humanoid.Health > 0 then
            if not ESP_Table[plr] then
                ESP_Table[plr] = {
                    Box = CreateDrawing("Square", {Thickness = 1.5, Filled = false, Color = Color3.white}),
                    Name = CreateDrawing("Text", {Size = 13, Center = true, Outline = true, Color = Color3.white}),
                    Health = CreateDrawing("Square", {Thickness = 1, Filled = true}),
                    Tracer = CreateDrawing("Line", {Thickness = 1, Color = Color3.fromRGB(0, 170, 255)})
                }
            end
            
            local d = ESP_Table[plr]
            local root = plr.Character.HumanoidRootPart
            local pos, vis = Camera:WorldToViewportPoint(root.Position)
            
            if vis then
                -- Get actual character size
                local humanoid = plr.Character:FindFirstChild("Humanoid")
                local head = plr.Character:FindFirstChild("Head")
                
                if humanoid and head then
                    local height = humanoid.HipHeight + 2
                    local width = 2
                    
                    local topPos = Camera:WorldToViewportPoint(root.Position + Vector3.new(0, height/2, 0))
                    local bottomPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, height/2, 0))
                    
                    local h = math.abs(topPos.Y - bottomPos.Y)
                    local w = h * 0.6
                    
                    if getgenv().NL_Config.ESP.Boxes then
                        d.Box.Visible = true
                        d.Box.Size = Vector2.new(w, h)
                        d.Box.Position = Vector2.new(pos.X - w/2, pos.Y - h/2)
                    else
                        d.Box.Visible = false
                    end
                    
                    if getgenv().NL_Config.ESP.Names then
                        d.Name.Visible = true
                        d.Name.Text = plr.Name
                        d.Name.Position = Vector2.new(pos.X, pos.Y - h/2 - 15)
                    else
                        d.Name.Visible = false
                    end
                    
                    if getgenv().NL_Config.ESP.Health then
                        d.Health.Visible = true
                        local hp = plr.Character.Humanoid.Health / plr.Character.Humanoid.MaxHealth
                        d.Health.Size = Vector2.new(3, h * hp)
                        d.Health.Position = Vector2.new(pos.X - w/2 - 6, (pos.Y - h/2) + (h * (1 - hp)))
                        d.Health.Color = Color3.fromRGB(255, 0, 0):Lerp(Color3.fromRGB(0, 255, 0), hp)
                    else
                        d.Health.Visible = false
                    end
                    
                    -- Tracer
                    d.Tracer.Visible = true
                    d.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    d.Tracer.To = Vector2.new(pos.X, pos.Y)
                end
            else
                d.Box.Visible = false
                d.Name.Visible = false
                d.Health.Visible = false
                d.Tracer.Visible = false
            end
        elseif ESP_Table[plr] then
            ESP_Table[plr].Box.Visible = false
            ESP_Table[plr].Name.Visible = false
            ESP_Table[plr].Health.Visible = false
            if ESP_Table[plr].Tracer then
                ESP_Table[plr].Tracer.Visible = false
            end
        end
    end
end)

-- 4. INPUT HANDLING
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    
    -- Menu Toggle
    if input.KeyCode == (getgenv().MenuKey or Enum.KeyCode.Insert) then
        MainFrame.Visible = not MainFrame.Visible
    end
    
    -- Toggle AimLock
    if input.KeyCode == getgenv().NL_Config.Aim.Key or input.UserInputType == getgenv().NL_Config.Aim.Key then
        if getgenv().NL_Config.Aim.Enabled then
            ToggleAim = not ToggleAim
            if not ToggleAim then
                LastTarget = nil
            end
        end
    end
end)

-- 5. ANIMATION & LOGIC SEQUENCE
-- 1. Animate Letters
TweenService:Create(LetterN, TweenInfo.new(1, Enum.EasingStyle.Bounce), {TextTransparency = 0}):Play()
task.wait(0.5)
TweenService:Create(LetterL, TweenInfo.new(1, Enum.EasingStyle.Bounce), {TextTransparency = 0}):Play()
task.wait(1)

-- 2. Animate Bar
TweenService:Create(LoadingBarFill, TweenInfo.new(2, Enum.EasingStyle.Quad), {Size = UDim2.new(1, 0, 1, 0)}):Play()
StatusText.Text = "Checking Environment..."
task.wait(0.5)
StatusText.Text = "Loading Assets..."
task.wait(1.5)
StatusText.Text = "Ready."

-- 3. Show Key System
LoaderFrame:TweenPosition(UDim2.new(0.5, -200, -0.5, 0), "In", "Back", 1, true)
task.wait(0.5)
KeyFrame.Visible = true

-- 4. Key Logic
EnterBtn.MouseButton1Click:Connect(function()
    if KeyInput.Text == getgenv().NL_Config.Key then
        KeyTitle.Text = "AUTHORIZED"
        KeyTitle.TextColor3 = Color3.fromRGB(0, 255, 0)
        task.wait(1)
        KeyFrame:TweenPosition(UDim2.new(0.5, -150, 1.5, 0), "In", "Back", 1, true)
        Authenticated = true
        MainFrame.Visible = true
        Widget.Visible = true
        
        -- Default Tab
        Tabs[1].Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        Tabs[1].Btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        Tabs[1].Page.Visible = true
        
        -- Play sound for authentication
        if game.SoundService then
            local sound = Instance.new("Sound")
            sound.SoundId = "rbxassetid://3570577835" -- Success sound
            sound.Volume = 0.5
            sound.Parent = workspace
            sound:Play()
            game:GetService("Debris"):AddItem(sound, 3)
        end
    else
        KeyTitle.Text = "INVALID KEY"
        KeyTitle.TextColor3 = Color3.fromRGB(255, 0, 0)
        KeyInput.Text = ""
        task.wait(1)
        KeyTitle.Text = "AUTHENTICATION"
        KeyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    end
end)

print("NeverLose Pre Alpha v0.1 Loaded Successfully!")
print("Menu Key: Insert")
print("AimLock Key: Q (Toggle Mode)") 
